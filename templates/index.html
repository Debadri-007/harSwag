<!DOCTYPE html>
<html>
<head>
    <title>Swagger Editor</title>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/swagger-ui/3.50.0/swagger-ui.css" >
</head>
<body>
    <form id="upload-form" enctype="multipart/form-data">
        <label for="har_file">Select .har File:</label>
        <input type="file" id="har_file" name="har_file">
        <br><br>
    <label for="domainNameInput">Domain Name:</label>
    <input type="text" id="domainNameInput" name="domainName">
    <br><br>
        <button type="submit">Upload</button>
      </form>
    
      <div id="response"></div>
    <div id="swagger-ui"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/swagger-ui/3.50.0/swagger-ui-bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/swagger-ui/4.1.6/swagger-ui-standalone-preset.js"></script>
    <script>
        
        window.onload = function() {
            const ui = SwaggerUIBundle({
                url: "/static/swagger.json",  // Modify the URL to match your Swagger JSON endpoint
                dom_id: '#swagger-ui',
                presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIBundle.SwaggerUIStandalonePreset
                ],
                layout: "BaseLayout"
            });
            window.ui = ui;
        }
    </script>
    <script>
        document.getElementById('upload-form').addEventListener('submit', function(event) {
          event.preventDefault();
          
          const domainName = document.getElementById('domainNameInput').value;
          var formData = new FormData();
          formData.append('har_file', document.getElementById('har_file').files[0]);
          formData.append('domainName', domainName || '');
    
          fetch('/convertswag', {
            method: 'POST',
            body: formData
          })
            .then(function(response) {
              if (response.ok) {
                response => response.json()
                return response.blob();
              } else {
                throw new Error('Request failed');
              }
            })
            .then(function(blob) {
              var downloadUrl = window.URL.createObjectURL(blob);
                
              // Create a link element to initiate the download
              var downloadLink = document.createElement('a');
              downloadLink.href = downloadUrl;
              downloadLink.download = 'har_Swagger.json';
              downloadLink.click();
              window.location.reload()
            })
            .catch(function(error) {
              console.error(error);
            });
        });
      </script>
</body>
</html>